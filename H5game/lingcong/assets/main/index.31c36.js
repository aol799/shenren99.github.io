window.__require=function t(e,o,r){function a(c,i){if(!o[c]){if(!e[c]){var l=c.split("/");if(l=l[l.length-1],!e[l]){var s="function"==typeof __require&&__require;if(!i&&s)return s(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+c+"'")}c=l}var p=o[c]={exports:{}};e[c][0].call(p.exports,function(t){return a(e[c][1][t]||t)},p,p.exports,t,e,o,r)}return o[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<r.length;c++)a(r[c]);return a}({ChatPlace:[function(t,e,o){"use strict";cc._RF.push(e,"52c277tOtpJa648mGhSrLI4","ChatPlace"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,n=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tellerNode=null,e.contentLabel=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.loadChat=function(t,e){var o=this;this.contentLabel&&this.tellerNode?(this.contentLabel.string=e,cc.loader.loadRes("UI/heroCard/"+t,cc.SpriteFrame,function(t,e){if(t)cc.error(t);else{var r=o.tellerNode.getComponent(cc.Sprite);r?r.spriteFrame=e:cc.error("Sprite component is not found on tellerNode!")}})):cc.error("contentLabel or tellerNode is not assigned!")},__decorate([n(cc.Node)],e.prototype,"tellerNode",void 0),__decorate([n(cc.Label)],e.prototype,"contentLabel",void 0),__decorate([a],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],ExpPanel:[function(t,e,o){"use strict";cc._RF.push(e,"3032exsdtVMT5Hy8d5kBv78","ExpPanel"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,n=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.expLabel=null,e.levelUpNode=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.showExp=function(t){if(this.expLabel&&this.levelUpNode){this.expLabel.string=t.toString();var e=parseInt(cc.sys.localStorage.getItem("LCLevel"))||1,o=parseInt(cc.sys.localStorage.getItem("LCExp"))||0;(o+=t)>100*e?(e+=1,o=0,this.levelUpNode.active=!0,this.levelUpNode.getComponent(cc.Label).string="\u7b49\u7ea7\u63d0\u5347\u81f3"+e+"\u7ea7"):this.levelUpNode.active=!1,cc.sys.localStorage.setItem("LCLevel",e.toString()),cc.sys.localStorage.setItem("LCExp",o.toString())}else cc.error("expLabel or levelUpNode is not assigned!")},__decorate([n(cc.Label)],e.prototype,"expLabel",void 0),__decorate([n(cc.Node)],e.prototype,"levelUpNode",void 0),__decorate([a],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],Hero:[function(t,e,o){"use strict";cc._RF.push(e,"f1b7aprXC9KhrLfrbpBeinB","Hero"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,n=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bloodBar=null,e.barNode=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.bloodBar?(this.barNode=this.bloodBar.node.getChildByName("bar"),this.barNode?this.bloodBar.width=this.barNode.width=this.node.width:cc.error("barNode is not found!")):cc.error("bloodBar is not assigned!")},e.prototype.updateShowBloodRate=function(t){this.barNode?(t=Math.max(0,Math.min(1,t)),this.barNode.width=Math.floor(this.node.width*t)):cc.error("barNode is not initialized!")},e.prototype.dead=function(){this.name,this.node.destroy()},__decorate([n(cc.ProgressBar)],e.prototype,"bloodBar",void 0),__decorate([n({type:cc.Node,visible:!1})],e.prototype,"barNode",void 0),__decorate([a],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],Main:[function(t,e){"use strict";cc._RF.push(e,"1b7df9UwrJDtZaSHZhwNeoK","Main"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onClickBack:function(){this.node.active=!1}}),cc._RF.pop()},{}],Menu:[function(t,e,o){"use strict";cc._RF.push(e,"ae51960fUFGwIRbXr43TG6L","Menu"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,n=r.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.audio=null,e.mainNode=null,e.storyNode=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.playMusic(),null==cc.sys.localStorage.getItem("LCLevel")&&(cc.sys.localStorage.setItem("LCLevel","1"),cc.sys.localStorage.setItem("LCExp","0"));var t=this.storyNode.getComponent("Story");t?t.menu=this:cc.error("Story component is missing on storyNode!")},e.prototype.playMusic=function(){this.audio&&cc.audioEngine.play(this.audio,!0,.5)},e.prototype.onDestroy=function(){cc.audioEngine.stopAll()},e.prototype.onClickStart=function(){this.mainNode.active=!0},e.prototype.goToChapter=function(t){if(this.storyNode){this.storyNode.active=!0;var e=this.storyNode.getComponent("Story");e?e.init(t):cc.error("Story component is missing on storyNode!")}else cc.error("storyNode is null!")},e.prototype.onClickTraining=function(){this.goToChapter("training")},e.prototype.onClick_1=function(){this.goToChapter("1")},e.prototype.onClick_2=function(){this.goToChapter("2")},e.prototype.onClick_3=function(){this.goToChapter("3")},e.prototype.onClick_4=function(){this.goToChapter("4")},e.prototype.onClick_5=function(){this.goToChapter("5")},e.prototype.onClick_6=function(){this.goToChapter("6")},__decorate([n({type:cc.AudioClip,url:cc.AudioClip})],e.prototype,"audio",void 0),__decorate([n(cc.Node)],e.prototype,"mainNode",void 0),__decorate([n(cc.Node)],e.prototype,"storyNode",void 0),__decorate([a],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],StoryGenerate:[function(t,e){"use strict";cc._RF.push(e,"a9cb70ODL1Jc5M1y8fVL7ZQ","StoryGenerate"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},calculateStory:function(t,e){for(var o=[],r=0;r<t.start.length;r++){var a=t.start[r];o.push({type:"talk",name:a.name,content:a.content})}var n=[],c=[],i=[],l=[];for(r=0;r<t.players.length;r++){var s=t.players[r];if(null!=s){var p=e[s];l.push({attack:p.attack,totHP:p.blood,nowHP:p.blood}),n.push({id:r,speed:p.speed}),r<6?c.push(r):i.push(r)}else l.push(null)}n=n.sort(function(t,e){return e.speed-t.speed});for(var d=0,h=0;h<30;h++){var u=[];for(r=0;r<n.length;r++)u.push(n[r]);for(r=0;r<u.length;r++){var y=u[r].id;if(y<6){if(-1==c.indexOf(y))continue;var f=i[Math.floor(Math.random()*i.length)],g=l[f],v=!1;if((m=Math.floor(l[y].attack*(.8+.3*Math.random())))>g.nowHP&&(m=g.nowHP,v=!0),o.push({type:"attack",s:y,t:f,damage:m}),g.nowHP-=m,o.push({type:"injured",id:f,nowHP:g.nowHP,totHP:g.totHP}),v){o.push({type:"dead",id:f}),l[f]=null;var _=[];if(i.forEach(function(t){t!=f&&_.push(t)}),(i=_).length<=0){d=1;break}}else l[f]=g}else{if(-1==i.indexOf(y))continue;var m,C=c[Math.floor(Math.random()*c.length)],x=l[C];if(v=!1,(m=Math.floor(l[y].attack*(.8+.3*Math.random())))>x.nowHP&&(m=x.nowHP,v=!0),o.push({type:"attack",s:y,t:C,damage:m}),x.nowHP-=m,o.push({type:"injured",id:C,nowHP:x.nowHP,totHP:x.totHP}),v){if(o.push({type:"dead",id:C}),l[C]=null,_=[],c.forEach(function(t){t!=C&&_.push(t)}),(c=_).length<=0){d=-1;break}}else l[C]=x}}if(0!=d)break}if(d>0){for(r=0;r<t.win.length;r++)p=t.win[r],o.push({type:"talk",name:p.name,content:p.content});o.push({type:"end",exp:t.exp})}else{for(r=0;r<t.lose.length;r++)p=t.lose[r],o.push({type:"talk",name:p.name,content:p.content});o.push({type:"end",exp:0})}return o}}),cc._RF.pop()},{}],Story:[function(t,e,o){"use strict";cc._RF.push(e,"fb979+fW01DZ78oqh37fuul","Story"),Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,n=r.property,c=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.posList=[],t.putPlace=null,t.chatPlace=null,t.expPanel=null,t.background=null,t.audio1=null,t.audio2=null,t.attackAudio=null,t.players=[],t.storyGenerator=null,t.tellStoryIdx=0,t.canTellStory=!1,t.playerFinishNum=0,t.topZIndex=1,t.storyData=null,t.chapterData=null,t.playerData=null,t.lastClickTime=null,t.audioID=null,t}return __extends(o,e),o.prototype.onLoad=function(){this.players=new Array(12).fill(null),this.storyGenerator=new(t("StoryGenerate")),this.tellStoryIdx=0,this.canTellStory=!1},o.prototype.onClickEnd=function(){this.putPlace.removeAllChildren(),this.node.active=!1},o.prototype.init=function(t){this.loadChapterData(t)},o.prototype.loadChapterData=function(t){var e=this;cc.loader.loadRes("Data/chapterData.txt",function(o,r){if(o)cc.log("err: failed to load file chapterData.txt");else{var a=JSON.parse(r)[t];a?e.loadPlayerData(a):cc.log("err: story has no chapterIdx with '"+t+"'")}})},o.prototype.loadPlayerData=function(t){var e=this;cc.loader.loadRes("Data/playerData.txt",function(o,r){if(o)cc.log("err: failed to load file playerData.txt");else{var a=JSON.parse(r);e.updateLinChongStats(a),e.startStory(t,a)}})},o.prototype.updateLinChongStats=function(t){var e=cc.sys.localStorage.getItem("LCLevel")||1;t.LinChong={attack:10*e+100*Math.floor(e/10)+1e3*Math.floor(e/100),blood:100*e+1e3*Math.floor(e/10)+1e4*Math.floor(e/100)+1e6*Math.floor(e/1e3),speed:5*e}},o.prototype.startStory=function(t,e){t&&e?(this.chapterData=t,this.playerData=e,this.storyData=this.storyGenerator.calculateStory(t,e),this.storyData?(this.loadBackground(t.bg),this.playBackgroundMusic(t.bgm),this.playerFinishNum=0,this.topZIndex=1,this.loadPlayers()):cc.log("err: failed to generate story data")):cc.log("err: chapterData or playerData is null")},o.prototype.loadBackground=function(t){var e=this;t?cc.loader.loadRes("bg/"+t,cc.SpriteFrame,function(t,o){t?cc.error(t):e.background.getComponent(cc.Sprite).spriteFrame=o}):cc.log("err: bgPath is null")},o.prototype.playBackgroundMusic=function(t){if(t){var e="Story"===t?this.audio1:this.audio2;e?this.audioID=cc.audioEngine.play(e,!0,.5):cc.log("err: audio clip is null")}else cc.log("err: bgm is null")},o.prototype.loadPlayers=function(){var t=this;if(this.chapterData&&this.chapterData.players)for(var e=function(e){var r=o.chapterData.players[e];if(!r)return o.handlePlayerLoadComplete(),"continue";cc.loader.loadRes("Heros/"+r,function(o,r){if(o)cc.error(o);else{var a=cc.instantiate(r);t.putPlace.addChild(a),a.setPosition(t.posList[e].getPosition()),a.width=t.posList[e].width,a.height=t.posList[e].height,a.zIndex=1,t.players[e]=a,t.handlePlayerLoadComplete()}})},o=this,r=0;r<12;r++)e(r);else cc.log("err: chapterData or players is null")},o.prototype.handlePlayerLoadComplete=function(){this.playerFinishNum++,this.playerFinishNum>=12&&(this.tellStoryIdx=0,this.canTellStory=!0)},o.prototype.tellStory=function(){if(this.canTellStory&&this.storyData&&!(this.tellStoryIdx>=this.storyData.length)){this.canTellStory=!1;var t=this.storyData[this.tellStoryIdx];if(t)switch(t.type){case"talk":this.handleTalk(t);break;case"attack":this.handleAttack(t);break;case"injured":this.handleInjured(t);break;case"dead":this.handleDead(t);break;case"end":this.handleEnd(t);break;default:cc.log("Unknown story type: "+t.type)}else cc.log("err: story content is null")}},o.prototype.handleTalk=function(t){this.chatPlace&&t?(this.chatPlace.active=!0,this.chatPlace.getComponent("ChatPlace").loadChat(t.name,t.content)):cc.log("err: chatPlace or content is null")},o.prototype.handleAttack=function(t){var e=this;if(t&&this.players){var o=t.s,r=t.t;if(void 0!==o&&void 0!==r&&this.players[o]&&this.players[r]){this.topZIndex+=10,this.players[o].zIndex=this.topZIndex;var a=this.players[o].getPosition(),n=this.players[r].getPosition(),c=cc.v2(n.x,n.y+(o<6?-50:50)),i=cc.sequence(cc.moveTo(.5,c),cc.moveTo(.2,n),cc.moveTo(.2,c),cc.moveTo(.5,a),cc.callFunc(function(){e.canTellStory=!0}));this.players[o].runAction(i),this.scheduleOnce(function(){cc.audioEngine.play(e.attackAudio,!1,.5)},.5),this.tellStoryIdx++}else cc.log("err: invalid player index")}else cc.log("err: content or players is null")},o.prototype.handleInjured=function(t){var e=this;if(t&&this.players){var o=t.id,r=t.nowHP,a=t.totHP;void 0!==o&&this.players[o]?(this.players[o].getComponent("Hero").updateShowBloodRate(r/a),this.tellStoryIdx++,this.scheduleOnce(function(){e.canTellStory=!0},.5)):cc.log("err: invalid player index")}else cc.log("err: content or players is null")},o.prototype.handleDead=function(t){var e=this;if(t&&this.players){var o=t.id;void 0!==o&&this.players[o]?(this.players[o].getComponent("Hero").dead(),this.tellStoryIdx++,this.scheduleOnce(function(){e.canTellStory=!0},.5)):cc.log("err: invalid player index")}else cc.log("err: content or players is null")},o.prototype.handleEnd=function(t){var e=this;this.expPanel&&t?(this.expPanel.active=!0,this.expPanel.getComponent("ExpPanel").showExp(t.exp),this.tellStoryIdx++,this.scheduleOnce(function(){e.canTellStory=!0},.5)):cc.log("err: expPanel or content is null")},o.prototype.closeExpPanel=function(){this.expPanel?this.expPanel.active=!1:cc.log("err: expPanel is null")},o.prototype.onClickNext=function(){(!this.lastClickTime||Date.now()-this.lastClickTime>500)&&(this.chatPlace.active=!1,this.tellStoryIdx++,this.canTellStory=!0,this.lastClickTime=Date.now())},o.prototype.update=function(){this.canTellStory&&this.storyData&&this.tellStoryIdx<this.storyData.length&&this.tellStory()},o.prototype.onEnable=function(){cc.audioEngine.stopAll()},o.prototype.onDisable=function(){this.resetState(),cc.audioEngine.stopAll()},o.prototype.resetState=function(){this.tellStoryIdx=0,this.storyData=null,this.chapterData=null,this.playerData=null,this.background.getComponent(cc.Sprite).spriteFrame=null},__decorate([n([cc.Node])],o.prototype,"posList",void 0),__decorate([n(cc.Node)],o.prototype,"putPlace",void 0),__decorate([n(cc.Node)],o.prototype,"chatPlace",void 0),__decorate([n(cc.Node)],o.prototype,"expPanel",void 0),__decorate([n(cc.Node)],o.prototype,"background",void 0),__decorate([n(cc.AudioClip)],o.prototype,"audio1",void 0),__decorate([n(cc.AudioClip)],o.prototype,"audio2",void 0),__decorate([n(cc.AudioClip)],o.prototype,"attackAudio",void 0),__decorate([a],o)}(cc.Component);o.default=c,cc._RF.pop()},{StoryGenerate:"StoryGenerate"}],"use_v2.0.x_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"ab512UhXIhG54DzVWsy3O9E","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["ChatPlace","ExpPanel","Hero","Main","Menu","Story","StoryGenerate","use_v2.0.x_cc.Toggle_event"]);